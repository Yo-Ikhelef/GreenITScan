services:
  database:
    image: mariadb:11.8.2
    environment:
      MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD}
      MYSQL_DATABASE: ${MYSQL_DATABASE}
    ports:
      - "3307:3306"    # si tu veux exposer localement
    volumes:
      - greenitscan_mariadb_data:/var/lib/mysql
    healthcheck:
      test: ["CMD", "mariadb-admin", "ping", "-p${MYSQL_ROOT_PASSWORD}"]
      interval: 5s
      timeout: 5s
      retries: 10

  backend:
    image: ghcr.io/${OWNER_LC}/${REPO_LC}/backend:${BACK_TAG}   # <— tag à choisir
    environment:
      APP_ENV: prod
      DATABASE_URL: ${DATABASE_URL}
      APP_SECRET: ${APP_SECRET}
      JWT_PASSPHRASE: ${JWT_PASSPHRASE}
      # Option B (recommandée) : clés JWT via base64
      JWT_PRIVATE_KEY_B64: ${JWT_PRIVATE_KEY_B64}
      JWT_PUBLIC_KEY_B64:  ${JWT_PUBLIC_KEY_B64}
    depends_on:
      - database
    ports:
      - "8081:8080"   # backend accessible sur http://localhost:8081

  frontend:
    image: ghcr.io/${OWNER_LC}/${REPO_LC}/frontend:${FRONT_TAG}  # <— tag à choisir
    environment:
      # Ton entrypoint génère /env.js avec cette valeur
      API_URL: "http://localhost:8081/api"
    ports:
      - "8080:80"    # front sur http://localhost:8080
volumes:
  greenitscan_mariadb_data:
